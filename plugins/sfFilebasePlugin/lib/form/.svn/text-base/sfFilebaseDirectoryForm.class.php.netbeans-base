//<?php
///**
// * This file is part of the sfFilebasePlugin package.
// *
// * For the full copyright and license information, please view the LICENSE
// * file that was distributed with this source code.
// *
// * @package   de.optimusprime.sfFilebasePlugin
// * @author    Johannes Heinen <johannes.heinen@gmail.com>
// * @license   MIT license
// * @copyright 2007-2009 Johannes Heinen <johannes.heinen@gmail.com>
// */
//class sfFilebaseDirectoryForm extends BasesfFilebaseDirectoryForm
//{
//  public function configure()
//  {
//    unset($this->widgetSchema['sf_filebase_files_id']);
//    $this->isMultipart(false);
//    $file = null;
//    if(!$this->isNew())
//    {
//      $file = $this->getObject()->getsfFilebasefile();
//    }
//    $file_form = new sfFilebaseFileForm($file);
//    $this->embedForm('directory_properties', $file_form);
//
//    $this->widgetSchema['directory_properties']['pathname'] = new sfWidgetFormInput(array('type'=>'text'));
//    $this->validatorSchema['directory_properties']['pathname'] = new sfValidatorAnd(array(
//      new sfValidatorString(),
//      new sfValidatorRegex(array('pattern'=>'#^\w+$#'))
//    ), array('required'=>true));
//  }
//
//  public function doSave($con = null)
//  {
//    $con === null && $con = Propel::getConnection();
//    try
//    {
//      $con->beginTransaction();
//      $values = $this->getValues();
//
//      $dir_object   = $this->getObject();
//      $file_object  = $this->embeddedForms['directory_properties']->getObject();
//
//      $dir_object->setsfFilebaseFile($file_object);
//      $file_object->setsfFilebaseDirectory($dir_object);
//
//      $f = sfFilebasePlugin::getInstance();
//      $parent_dir_id = $values['directory_properties']['sf_filebase_directories_id'];
//      $name = $values['directory_properties']['pathname'];
//      $path = '';
//      if(empty($parent_dir_id))
//      {
//        $path = $f;
//      }
//      else
//      {
//        $parent_dir_object = sfFilebaseDirectoryPeer::retrieveByPK($parent_dir_id);
//        $path = $f[$parent_dir_object->getsfFilebaseFile()->getPathname()];
//      }
//
//      $pathname = $f->mkdir($path . '/' . $name);
//
//      $file_object->setPathname((string)$pathname);
//      $file_object->setHash($pathname->getHash());
//      $file_object->save();
//
//      return parent::doSave();
//    }
//    catch (Exception $e)
//    {
//      $con->rollBack();
//      throw $e;
//    }
//  }
//}
